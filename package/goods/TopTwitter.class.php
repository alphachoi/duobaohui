<?php

namespace Snake\Package\Goods;

/**
 * 
 * 海报取推置顶类
 *
 * 一个白名单alpha版, 通过调用取得置顶推
 *
 * @author Xuan Zheng <xuanzheng@meilishuo.com>
 * @package 宝库
 */

class TopTwitter {
	private $kuziTwitterIds = array( 
	);

	private $qunziTwitterIds = array(
	);

	private $yifuTwitterIds_bk = array(
	);

	private $yifuTwitterIds = array(
	);

	private $yifuPlans = array(
		'r1c3', 'r2c3', 'r3c3', 'r6c3',
		'r10c3', 'r16c3', 'r20c3', 'r25c3',
		'r1c2','r1c4','r10c2','r10c4',
	);

	private $dadikuTids = array(
		479513173, 479514926, 479516955, 479518230,
		479586094, 479588641, 479590488, 479591422,
		479248786, 479247567, 479248222, 
	);

	private $xizhuangTids = array(
		479594935, 479252777, 479251481, 479250553,
	);

	private $leisishanTids = array(
		479529609,479531715,
	);

	private $lianyiqun = array(
		479592714, 479249943,
	);
	
	private $changxiutxu = array(
		479593818,
	);

	private $zhenzhishan = array(
		479521500,
	);

	private $waitao = array(
		479533070,479597544,
	);

	private $fengyi = array(
		479249306,
	);

	private $yifuTop = array(
		487152685, 337173546, 465290167, 527912329, 283637246, 485879241, 525260140, 508036601, 537216680, 446579583,
		528241940, 315307201, 505545405, 484624223, 520487433, 233114743, 535215808, 356994510, 481459894, 499177366,
		448296718, 539462976, 489639074, 504769158, 517647682, 521705940, 513620604, 532913034, 392196718,
		531699724, 536599124, 424120368, 379192834, 437362239, 505760099, 459016014, 524576123, 459187565, 531999815,
		430489793, 521260243, 442968949, 487133936, 517859385, 468881002, 369374658, 332924939, 283148551, 406022351,
		516460514, 398915347, 444545262, 189253167, 537115744, 468842419, 543581484, 535792352, 504923664, 328948163,
		518938451, 472136486, 442967325, 531420239, 524387395, 459369517, 420829777, 502184239, 471647852,
		484719375, 455797875, 540330001, 545664079, 518729000, 439506995, 490767257, 516438969, 454562763, 517326298,
		429711198, 227807344, 481145878, 490454041, 496666907, 490796946, 378149048, 409227398, 482635075, 198638371,
		485907476, 405234687, 429566208, 466747722, 487327384, 474201171, 469235981, 543501505,
		479726834, 524744867, 464160564, 535825708, 506453069, 519689247, 488253362, 538693812, 493328014,
		496422444, 281491456, 461363824, 486995702, 521752871, 464987606, 437272503, 366207863, 507171123, 494344793,
		523584460, 474279998, 498100144, 437821333, 513548042, 488937247, 221607439, //228329673, 522764175, 464899656,
//		521369647, 521369647, 399112529, 384428955, 536125574, 449724582, 516912809, 499901279, 464602613, 523666231,
//		499349984, 531414109, 536137241, 521754132, 427894123, 211606973, 371463557, 503777520, 481963045, 529074275,
//		442943928, 427112113, 493419067, 534844786, 539087007, 491304385, 529760634, 535797407, 537773892, 528103418,
//		539661784, 508784062, 302170703, 522104520, 337478063, 396772195, 536447546, 516433392, 488268313, 415031657,
//		532016157, 445563163, 535668107, 539718220, 272314182, 544461704, 530456776, 210849585, 485985212, 531268323,
//		544301045, 381020021, 366379175, 461915137, 491129144, 507608238, 488892997, 532194868, 254857266, 505752851,
//		529129983, 408907386, 439804103, 519349338, 508713714, 189750632, 459035952, 504451659, 523656186, 497606227,
//		463801198, 499186132, 539574312, 236950379, 230886647, 539399280, 523385357, 523385357, 219616117, 484680855,
//		527103982, 437638154, 527704696, 
	); 


	private $xieziTop = array(
		378059675, 245920053, 230040479, 493931187, 236927967, 449728527, 429198744, 487687326, 423489550,
		472589377, 466714877, 343437125, 219883697, 338698557, 353432737, 381434941, 267062950, 491855559, 
		514517010, 380746452, 400326145, 463250604, 337968522, 311715619, 434563032, 475015849, 544457576,
		427521366, 379212633, 494706898, 262244096, 504431325, 453980638, 237042291, 399600704,
		271987748, 247103837, 369024693, 403170003, 391348843, 494798442, 465208884, 261577672,
		212407485, 490182888, 465178679, 352165978, 462285717, 439799443, 524495786, 429273531, 441904857, 355203850,
		451886815, 524614387, 514990324, 260919366, 464141142, 391092129, 466939339, 
		366023706, 443157556, 455734409, 242860118, 454978333, 419706095, 381800395, 244988340, 466376812,
		392498056, 238266339, 287372421, 439859750, 408610913, 492790393, 388458228, 431073368,
		413445642, 420758803, 515468096, 507008155, 500067169, 481353295, 429792217, 422718109, 460323274, 400973250,
		547509539, 419710599, 519077069, 369003252, 268286669, 498652382, 283765939, 523677030, 
		278874065, 507231556, 544984618, 484730976, 414685546, 449543148, 229556107, 515625111, 539751479, 
		397507921, 230079675, 517936587, 495829564, 244170045, 544285752, 515003132, 260981604,
		494810443, 477354782, 498353346, 488099886, 482699688, 471590169, 515394193, 230119869, 462685398, 525242544,
		419705926, 477743511, //383669289, 475636263, 475636263, 465923058, 484026513, 
);

	public function getCatalogTopTwitterIds($cataId = 0, $request = NULL) {
		return array();
//		$date = date("Ymd");
//		if ($date < 20120926 || $date > 20121003 ) {
//			return array();
//		}
		$wordId = $request->getWordId();
		$inAb = $request->getAb();

		if (empty($inAb)) {
			return array();
		}
		if ($cataId == 2000000000000 && empty($wordId)) {
			return $this->yifuTop;	
		}
		if ($cataId == 6000000000000 && empty($wordId)) {
			return $this->xieziTop;	
		}
		return array();

//		if ($cataId == 2000000000000 && $wordId == 34363) {
//			return $this->xizhuangTids;	
//		}
//		if ($cataId == 2000000000000 && $wordId == 38123) {
//			return $this->changxiutxu;
//		}
//		if (($cataId == 2000000000000 || $cataId == 2006000000000) && $wordId == 34328) {
//			return $this->zhenzhishan;
//		}
//		if (($cataId == 2000000000000 || $cataId == 2001000000000) && $wordId == 34369) {
//			return $this->fengyi;
//		}
//
//		if ($cataId == 2001000000000 && $wordId == 34341) {
//			return $this->leisishanTids;	
//		}
//
//		if (($cataId == 2001000000000 || $cataId == 2000000000000)  && $wordId == 34362) {
//			return $this->waitao;	
//		}
//		if (($cataId == 2004000000000 || $cataId == 2000000000000) && $wordId == 34295) {
//			return $this->lianyiqun;
//		}
//		if (($cataId == 2006000000000 || $cataId == 2000000000000) && $wordId == 34423) {
//			return $this->dadikuTids;	
//		}
//
//
//		if ($cataId == 2004000000000) {
//			return array();
//			//return 	$this->qunziTwitterIds;
//		}
//		else if ($cataId == 2006000000000) {
//			return array();	
//			//return 	$this->kuziTwitterIds;
//		}	
//		else if ($cataId == 2000000000000) {
//			return array();
//			//return $this->yifuTwitterIds;
//			$tids = $this->getTids($request);
//			return $tids; 
//		}
//		return array();
	}

	private function getTids($request = NULL) {
		$date = date("YmdHis");
		if ($date < '20120925120000' || $date > '20120926120000') {
			return array();
		}
		$log = new \Snake\Libs\Base\SnakeLog("toptwitter_warning_fix_log", 'normal');


		$planRand = $this->getRand();

		$plan = $this->yifuPlans[$planRand];
		//require("/home/work/snake/package/goods/TopTidCatalog.php");
//		require_once("/Users/ZX/Sites/snake/trunk/package/goods/TopTidCatalog.php");
		$request->setTopPlan($plan);
		$tidsTmp = $$plan;
		$tids = array();
		if (!is_array($tidsTmp)) {
			$tidsTmp = array();
			$log->w_log(print_r($plan, TRUE));
			$log->w_log(print_r($tidsTmp, TRUE));
		}
		foreach ($tidsTmp as $t) {
			if (!trim($t)) {
				continue;
			}
			$tids[] = trim($t);	
		}

		$cacheHelper = new TopTidCatalogCoutCache($plan);
		$num = $cacheHelper->getCache();
		$num +=1;
		$cacheHelper->setCache($num);
		return $tids;
	}

	private function getRand() {
		$planRand = $_COOKIE['MEILISHUO_CATA_PLAN'];
		if (empty($planRand)) {
			$planRand = rand(1,12);
			setcookie('MEILISHUO_CATA_PLAN', $planRand, time() + 60 * 30, DEFAULT_COOKIEPATH, DEFAULT_COOKIEDOMAIN);
		}
		return $planRand - 1;	
	}

	public function getShowNum() {
		foreach ($this->yifuPlans as $plan) {
			$cacheHelper = new TopTidCatalogCoutCache($plan);
			$num = $cacheHelper->getCache();
			$echo .= "{$plan} : {$num}\n";
		}
		return $echo;
	}
}
